{"id":2518792,"slug":"wu7dsa","title":"录制原理","book_id":187563,"book":{"id":187563,"type":"Book","slug":"uirecorder","name":"UIRecorder","user_id":296279,"description":"一端录制，多端使用的便捷 UI 自动化测试工具","creator_id":94302,"public":1,"items_count":22,"likes_count":0,"watches_count":12,"content_updated_at":"2019-10-11T06:31:45.205Z","updated_at":"2019-10-11T06:31:45.000Z","created_at":"2018-12-11T06:11:00.000Z","namespace":"artist/uirecorder","user":{"id":296279,"type":"Group","login":"artist","name":"F&D艺术家-前端自动化测试","description":"探索与推广前端自动化测试","avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150693943-avatar/c80e9798-27e4-4238-8760-4bb5828a7228.png","large_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150693943-avatar/c80e9798-27e4-4238-8760-4bb5828a7228.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150693943-avatar/c80e9798-27e4-4238-8760-4bb5828a7228.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150693943-avatar/c80e9798-27e4-4238-8760-4bb5828a7228.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":4,"public_books_count":4,"followers_count":0,"following_count":0,"created_at":"2019-03-21T06:44:55.000Z","updated_at":"2019-08-08T02:30:37.000Z","_serializer":"v2.user"},"_serializer":"v2.book"},"user_id":94302,"creator":{"id":94302,"type":"User","login":"linshuoting","name":"说听(Stngle)","description":"F&D艺术家   \nhttps://github.com/Stngle","avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150368242-avatar/4fa5a6cc-1636-43cd-b085-fce8ad30be09.png","large_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150368242-avatar/4fa5a6cc-1636-43cd-b085-fce8ad30be09.png?x-oss-process=image/resize,m_fill,w_320,h_320","medium_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150368242-avatar/4fa5a6cc-1636-43cd-b085-fce8ad30be09.png?x-oss-process=image/resize,m_fill,w_160,h_160","small_avatar_url":"https://cdn.nlark.com/yuque/0/2019/png/94302/1553150368242-avatar/4fa5a6cc-1636-43cd-b085-fce8ad30be09.png?x-oss-process=image/resize,m_fill,w_80,h_80","books_count":2,"public_books_count":1,"followers_count":8,"following_count":6,"created_at":"2018-03-21T12:59:06.000Z","updated_at":"2019-10-09T08:37:02.000Z","_serializer":"v2.user"},"format":"lake","body":"","body_draft":"","body_html":"<!doctype html><div class=\"lake-content-editor-core lake-engine\" data-lake-element=\"root\" data-selection-94302=\"%7B%22path%22%3A%5B%5B24%2C2%2C1%2C0%2C83%5D%2C%5B24%2C2%2C1%2C0%2C83%5D%5D%2C%22uuid%22%3A%2294302%22%2C%22active%22%3Atrue%7D\"><h2 id=\"nqgNP\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 24px; line-height: 32px;\">一、原理流程图</h2><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><span data-card-type=\"inline\" data-lake-card=\"image\"><img data-role=\"image\" src=\"https://cdn.nlark.com/yuque/0/2019/png/94302/1570633612857-4c4418d6-a8e5-40aa-8341-3e461fa796b9.png?x-oss-process=image/resize,w_1500\" data-raw-src=\"https://cdn.nlark.com/yuque/0/2019/png/94302/1570633612857-4c4418d6-a8e5-40aa-8341-3e461fa796b9.png\" class=\"image lake-drag-image\" alt=\"image.png\" title=\"image.png\" style=\"visibility: visible; width: 746px; height: 350px;\"></span></p><p style=\"text-align: center; font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><em><u>原理流程图</u></em></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; 录制功能主要由 Chrome Extension 和 Node Process 两部分组成：</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; Chrome Extension 会对当前浏览器进行全局事件监听，当触发某个事件（比如 click）时，即获取当前操作元素的节点信息，同时通过 WebSocket 发送指令（开始录制、录制、结束录制）、数据（事件类型、节点信息）至 Node Process。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; Node Process 接收到 Chrome Extension 的请求指令、数据，将其记录在一个数组中，当 Chrome Extension 发起结束录制指令时，结合记录队列和配置的脚本模版，生成测试用例脚本至指定目录（如 <code style=\"font-family: monospace; font-size: inherit; background-color: rgba(0, 0, 0, 0.06); padding: 0px 2px; border: 1px solid rgba(0, 0, 0, 0.08); border-radius: 2px; line-height: inherit; overflow-wrap: break-word; text-indent: 0px;\">sample/test.spec.js</code>&nbsp;）。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"so298\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">1.1 事件驱动</h3><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; UIRecorder 的录制功能基于事件驱动，默认触发某个事件的操作行为，都作为有效操作记录下来。记录一系列的操作行为，即记录一系列的事件行为。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"vRn3J\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">1.2 捕获元素</h3><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; UIRecorder 事件操作的元素信息，基于 DOM 进行定位，UIRecorder 主要选择&nbsp;<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors\" target=\"_blank\">CSS Selector</a>&nbsp;的方式进行定位，捕获元素信息主要包括标签（tag）、属性（attribute）、文本内容（text）、值（value）。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp;</p><h3 id=\"61TYN\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">1.3 Websocket 通信</h3><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<a href=\"https://en.wikipedia.org/wiki/WebSocket\" target=\"_blank\">WebSocket</a>&nbsp;<span>是一种网络传输协议，可在单个 TCP 连接上进行全双工通信。UIRecorder 主要利用 WebSocket 实现 Chrome Extension 与 Node Process 的通信，Chrome Extension 将录制过程的相关指令、数据（事件类型、节点信息）传输至 Node Process。</span></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"ninvu\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">1.4 生成脚本</h3><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; Chrome Extension 会向 Node Process 发送指令、数据。指令主要包括开始录制、录制、结束录制：开始录制时，Node Process 会初始化一个数组；录制过程中，将数据（事件类型、元素信息）push 至数组中；结束录制时，将数组与定义好的脚本模版结合，生成测试用例脚本。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">&nbsp; &nbsp; &nbsp; &nbsp; 其中，不同事件类型会配置不同脚本模版，结合元素信息及脚本模版，即可生成该操作行为对应的回归脚本代码。</p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h2 id=\"xHePq\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 24px; line-height: 32px;\">二、更多参考</h2><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><blockquote style=\"padding-left: 1em; margin-top: 5px; margin-bottom: 5px; margin-left: 0px; border-left: 3px solid rgb(238, 238, 238); opacity: 0.6;\"><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">Node.js http 模块：<a href=\"http://nodejs.cn/api/http.html\" target=\"_blank\">http://nodejs.cn/api/http.html</a></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">Node.js fs 模块：<a href=\"http://nodejs.cn/api/fs.html\" target=\"_blank\">http://nodejs.cn/api/fs.html</a></p><p style=\"font-size: 14px; color: rgb(38, 38, 38); line-height: 24px; letter-spacing: 0.05em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">DOM：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Introduction\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Introduction</a></p></blockquote></div>","body_lake":"<!doctype lake><meta name=\"doc-version\" content=\"1\" /><h2 id=\"nqgNP\">一、原理流程图</h2><p><br /></p><p><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2019%2Fpng%2F94302%2F1570633612857-4c4418d6-a8e5-40aa-8341-3e461fa796b9.png%22%2C%22originWidth%22%3A2252%2C%22originHeight%22%3A1058%2C%22name%22%3A%22image.png%22%2C%22size%22%3A398743%2C%22display%22%3A%22inline%22%2C%22align%22%3A%22left%22%2C%22linkTarget%22%3A%22_blank%22%2C%22status%22%3A%22done%22%2C%22search%22%3A%22%22%2C%22width%22%3A750.6666666666666%2C%22height%22%3A353%7D\"></card></p><p style=\"text-align: center;\"><em><u>原理流程图</u></em></p><p><br /></p><p>        录制功能主要由 Chrome Extension 和 Node Process 两部分组成：</p><p>        Chrome Extension 会对当前浏览器进行全局事件监听，当触发某个事件（比如 click）时，即获取当前操作元素的节点信息，同时通过 WebSocket 发送指令（开始录制、录制、结束录制）、数据（事件类型、节点信息）至 Node Process。</p><p>        Node Process 接收到 Chrome Extension 的请求指令、数据，将其记录在一个数组中，当 Chrome Extension 发起结束录制指令时，结合记录队列和配置的脚本模版，生成测试用例脚本至指定目录（如 <code>sample/test.spec.js</code> ）。</p><p><br /></p><h3 id=\"so298\">1.1 事件驱动</h3><p>        UIRecorder 的录制功能基于事件驱动，默认触发某个事件的操作行为，都作为有效操作记录下来。记录一系列的操作行为，即记录一系列的事件行为。</p><p><br /></p><h3 id=\"vRn3J\">1.2 捕获元素</h3><p>        UIRecorder 事件操作的元素信息，基于 DOM 进行定位，UIRecorder 主要选择 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Selectors\" target=\"_blank\">CSS Selector</a> 的方式进行定位，捕获元素信息主要包括标签（tag）、属性（attribute）、文本内容（text）、值（value）。</p><p> </p><h3 id=\"61TYN\">1.3 Websocket 通信</h3><p>        <a href=\"https://en.wikipedia.org/wiki/WebSocket\" target=\"_blank\">WebSocket</a> <span>是一种网络传输协议，可在单个 TCP 连接上进行全双工通信。UIRecorder 主要利用 WebSocket 实现 Chrome Extension 与 Node Process 的通信，Chrome Extension 将录制过程的相关指令、数据（事件类型、节点信息）传输至 Node Process。</span></p><p><br /></p><h3 id=\"ninvu\">1.4 生成脚本</h3><p>        Chrome Extension 会向 Node Process 发送指令、数据。指令主要包括开始录制、录制、结束录制：开始录制时，Node Process 会初始化一个数组；录制过程中，将数据（事件类型、元素信息）push 至数组中；结束录制时，将数组与定义好的脚本模版结合，生成测试用例脚本。</p><p>        其中，不同事件类型会配置不同脚本模版，结合元素信息及脚本模版，即可生成该操作行为对应的回归脚本代码。</p><p><br /></p><h2 id=\"xHePq\">二、更多参考</h2><p><br /></p><blockquote style=\"padding-left: 1em;\"><p>Node.js http 模块：<a href=\"http://nodejs.cn/api/http.html\" target=\"_blank\">http://nodejs.cn/api/http.html</a></p><p>Node.js fs 模块：<a href=\"http://nodejs.cn/api/fs.html\" target=\"_blank\">http://nodejs.cn/api/fs.html</a></p><p>DOM：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Introduction\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Introduction</a></p></blockquote>","public":1,"status":null,"likes_count":2,"comments_count":0,"content_updated_at":"2019-10-11T03:21:45.000Z","deleted_at":null,"created_at":"2019-09-02T02:10:50.000Z","updated_at":"2019-10-11T05:43:32.000Z","published_at":"2019-10-11T03:28:27.000Z","first_published_at":"2019-10-11T03:21:45.000Z","word_count":588,"cover":null,"description":"一、原理流程图原理流程图        录制功能主要由 Chrome Extension 和 Node Process 两部分组成：        Chrome Extension 会对当前浏览器进行全局事件监听，当触发某个事件（比如 click）时，即获取当前操作元素的节点信息，同时通过 W...","custom_description":null,"_serializer":"v2.doc_detail"}